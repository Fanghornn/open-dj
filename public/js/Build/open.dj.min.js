!function(){"use strict";var e={searching:!1,lastSearchedPattern:null,playing:!1,resultsCount:0,currentPage:1,playlist:{},pingTimeOutPopup:void 0,reSyncPopup:void 0,initialize:function(){$(".button-collapse").sideNav(),$("#launch-search").on("click",function(e){e.preventDefault(),n.launchYtSearch()}),$(document).on("keyup",function(e){if($("#yt-search").is(":focus")){var t=e.keyCode||e.which;13==t&&(e.preventDefault(),n.launchYtSearch())}}),$(".volume-up").on("click",function(e){e.preventDefault(),SocketManager.modifyVolume("up")}),$(".volume-down").on("click",function(e){e.preventDefault(),SocketManager.modifyVolume("down")}),$(".music-pause").on("click",function(e){e.preventDefault(),SocketManager.conn.emit("pause")}),$(".music-resume").on("click",function(e){e.preventDefault(),SocketManager.conn.emit("resume")}),$(".switch-theme").on("click",function(e){e.preventDefault();var n,t=$("html").css("background-color");n="rgb(246, 244, 241)"===t?{"background-color":"#242220",color:"white"}:{"background-color":"#F6F4F1",color:"black"},$("html,body").each(function(){$(this).css(n)})}),$("#page-prev").on("click",function(){n.getPage("-")}),$("#page-next").on("click",function(){n.getPage("+")})},launchYtSearch:function(){if(!SocketManager.linkServerEnabled)return void alertify.error("Recherche non disponible.");if(!n.searching){n.currentPage=1;var e=$("#yt-search").val();""!==e?(n.searching=!0,e=e.replace(/ /g,"+"),n.lastSearchedPattern=e.toLowerCase(),SocketManager.conn.emit("yt-search",e),n.toggleOverlay()):alertify.error("Tu veux faire une recherche vide ...?<br/>Tu vas pas trouver grand chose mon pote.")}},YtSearchResponse:function(e){e=n.getHtmlResult(e),$("#search-yt-results").html(e).find("a").click(function(e){e.preventDefault(),n.manageClickVideo(this)}),n.searching=!1,n.toggleOverlay()},manageClickVideo:function(e){if("undefined"==typeof e.href.split("v=")[1])return void alertify.error("On dirais que t'as choisis autre chose qu'une video(chaine youtube ou autre), ça va pas marcher :(<br/>Essayes encore =D");var n=$(e).parent().find(".result-block-title").text(),t="",i={action:"play",id:e.href.split("v=")[1],title:n,image:t};SocketManager.conn.emit("video",i)},getHtmlResult:function(e){n.resultsCount=0;var t="",i=$.parseHTML(e);return n.resultsCount=$(i).find(".yt-lockup").size(),$(i).find(".yt-lockup").each(function(e){var i,o,r,a;if($(this).find("button").each(function(){$(this).remove()}),i=$(this).find(".yt-lockup-thumbnail"),r=$(i).find("a").prop("href"),a=$(this).find(".yt-lockup-content").find("a").html(),e>5){var c=n.forceImageDisplay(i);c!==!1&&$(i).find("img").prop("src",c)}o=$(i).find("img").prop("src");var l='<div class="result-block col s12 m12 l4">';l+='<a href="'+r+'">',l+='<img class="result-block-img" src="'+o+'"/>',l+='</a><br/><span class="result-block-title">'+a+"</span>",l+="</div>",t+=l}),t},forceImageDisplay:function(e){var n=$(e).find("img"),t=$(n).attr("src").split("."),i=t[t.length-1];return"gif"===i?$(n).data("thumb"):!1},initAlertChoice:function(){alertify.confirm().set({modal:!1,message:"Une musique est déjà en cours de lecture...",onok:function(){SocketManager.forceMusic(),$(".alertify").remove()},oncancel:function(e){SocketManager.addPlaylist(),$(".alertify").remove()},labels:{ok:"Fait péter le son !",cancel:"Ajouter à la playlist"},title:"C'est embarassant..."}).show();$(".ajs-close").on("click",function(e){return e.preventDefault(),alertify.closeAll(),$(".alertify").remove(),!1})},addItemToServerPlaylist:function(){for(var e in n.playlist)if(e===SocketManager.musicSelected)return void alertify.warning("Cette musique est déjà dans la playlist.");SocketManager.addPlaylist()},toggleOverlay:function(e){if($("#overlay").length>0||e===!0)return void $("#overlay").remove();var n='<div id="overlay"><div class="progress"><div class="indeterminate"></div></div>';$(n).appendTo("body")},getPage:function(e){n.toggleOverlay(),"+"===e?n.currentPage++:n.currentPage--,window.scrollTo(0,0),SocketManager.pageSwitch(n.currentPage)},setVolumeIndicator:function(e){$(".volume-indicator").each(function(){$(this).text(e)})},reSynced:function(){void 0!==typeof n.reSyncPopup&&clearTimeout(n.reSyncPopup),n.reSyncPopup=setTimeout(function(){alertify.closeAll(),alertify.dismissAll(),$("#overlay-transparent-loader").addClass("hidden"),alertify.success("Connexion rétablie !<br/>Bonne écoute sur Open-Dj"),n.toggleOverlay(!0),n.reSyncPopup=void 0},3e3)},pingTimeout:function(){void 0!==typeof n.pingTimeOutPopup&&clearTimeout(n.pingTimeOutPopup);var e="Connexion avec le serveur perdue :(<br/><br/>Le service sera indisponible tant que la liaison n'est pas réétablie",t="Reconnexion...";n.pingTimeOutPopup=setTimeout(function(){alertify.closeAll(),alertify.dismissAll(),alertify.alert("Connexion perdue",e).set("onok",function(e){$("#overlay-transparent-loader").removeClass("hidden"),alertify.error(t,0)}),n.pingTimeOutPopup=void 0},3e3)},refreshPlaylist:function(e){}},n=e;window.YoutubePlayer=e}(),function(){"use strict";var e={conn:!1,youtubePlayerInitialized:!1,musicSelected:null,linkServerEnabled:!1,initialize:function(){var e=$("#config").data("host"),t=$("#config").data("port");$("#config").remove();var i=t.length>0?e+":"+t:e;n.conn=io.connect(i),n.conn.on("disconnect",function(){n.linkServerEnabled=!1,YoutubePlayer.pingTimeout()}),n.conn.on("connect",function(e){n.linkServerEnabled=!0,n.youtubePlayerInitialized?n.reSyncWithServer():(n.conn.emit("new_user"),YoutubePlayer.initialize(),n.youtubePlayerInitialized=!0)}),n.conn.on("yt-result",function(e){YoutubePlayer.YtSearchResponse(e.result),$("#yt-result-scroller").is(":visible")||$("#yt-result-scroller").toggleClass("hidden"),(1==YoutubePlayer.currentPage&&20==YoutubePlayer.resultsCount||YoutubePlayer.currentPage>=2&&20==YoutubePlayer.resultsCount)&&($("#page-next").is(":visible")||$("#page-next").toggleClass("hidden")),YoutubePlayer.currentPage>=2?$("#page-prev").is(":visible")||$("#page-prev").toggleClass("hidden"):1===YoutubePlayer.currentPage&&$("#page-prev").is(":visible")&&$("#page-prev").toggleClass("hidden")}),n.conn.on("update-current-music",function(e){YoutubePlayer.updateCurrentMusic(e)}),n.conn.on("annoucement",function(e){alertify.warning(e)}),n.conn.on("ask-force",function(e){n.musicSelected=e,YoutubePlayer.initAlertChoice()}),n.conn.on("volume-value",function(e){YoutubePlayer.setVolumeIndicator(e)}),n.conn.on("playlist",function(e){YoutubePlayer.refreshPlaylist(e)})},reSyncWithServer:function(){var e={searchingPattern:YoutubePlayer.lastSearchedPattern};n.conn.emit("reSyncUser",e),YoutubePlayer.reSynced()},forceMusic:function(){n.conn.emit("forceChange",n.musicSelected),n.musicSelected=null},addPlaylist:function(){n.musicSelected.action="add",n.conn.emit("playlist",n.musicSelected)},modifyVolume:function(e){n.conn.emit("modifyVolume",e)},pageSwitch:function(e){n.conn.emit("result-page-change",e)}},n=e;$(document).ready(function(){e.initialize()}),window.SocketManager=e}();