!function(){"use strict";var e={searching:!1,searchPatternApi:"api/yt-search/",playSoundApi:"api/play-song",lastSearchedPattern:null,playing:!1,resultsCount:0,currentPage:1,playlist:{},pingTimeOutPopup:void 0,reSyncPopup:void 0,initialize:function(){$(".button-collapse").sideNav(),$("#launch-search").on("click",function(e){e.preventDefault(),n.launchYtSearch()}),$(".volume-up").on("click",function(e){e.preventDefault(),SocketManager.modifyVolume("up")}),$(".volume-down").on("click",function(e){e.preventDefault(),SocketManager.modifyVolume("down")}),$(".music-pause").on("click",function(e){e.preventDefault(),SocketManager.conn.emit("pause")}),$(".music-resume").on("click",function(e){e.preventDefault(),SocketManager.conn.emit("resume")}),$(".switch-theme").on("click",function(e){e.preventDefault();var n,t=$("html").css("background-color");n="rgb(246, 244, 241)"===t?{"background-color":"#242220",color:"white"}:{"background-color":"#F6F4F1",color:"black"},$("html,body").each(function(){$(this).css(n)})}),$("#page-prev").on("click",function(){n.getPage("-")}),$("#page-next").on("click",function(){n.getPage("+")})},launchYtSearch:function(){if(!SocketManager.linkServerEnabled)return void alertify.error("Recherche non disponible.");if(!n.searching){n.currentPage=1;var t=$("#yt-search").val();""!==t?(n.searching=!0,t=t.replace(/ /g,"+"),n.lastSearchedPattern=t.toLowerCase(),$.ajax({type:"GET",url:n.buildSearchUrl(),success:e.YtSearchResponse,error:function(){n.toggleOverlay(),n.searching=!1,alertify.error("Impossible de lancer une recherche :(")}}),n.toggleOverlay()):alertify.error("Tu veux faire une recherche vide ...?<br/>Tu vas pas trouver grand chose mon pote.")}},YtSearchResponse:function(e){e=$.parseJSON(e),e=e.result,e=n.getHtmlResult(e),$("#search-yt-results").html(e).find("a").click(function(e){e.preventDefault(),n.manageClickVideo(this)}),n.searching=!1,n.toggleOverlay(),$("#yt-result-scroller").is(":visible")||$("#yt-result-scroller").toggleClass("hidden"),(1==n.currentPage&&20==n.resultsCount||n.currentPage>=2&&20==n.resultsCount)&&($("#page-next").is(":visible")||$("#page-next").toggleClass("hidden")),n.currentPage>=2?$("#page-prev").is(":visible")||$("#page-prev").toggleClass("hidden"):1===n.currentPage&&$("#page-prev").is(":visible")&&$("#page-prev").toggleClass("hidden")},manageClickVideo:function(e){if("undefined"==typeof e.href.split("v=")[1])return void alertify.error("On dirais que t'as choisis autre chose qu'une video(chaine youtube ou autre), ça va pas marcher :(<br/>Essayes encore =D");var e={id:e.href.split("v=")[1],title:$(e).parent().find(".result-block-title").text(),image:""};n.playSong(e,!1)},playSong:function(e,t){var r={id:e.id,title:e.title,image:e.image,force:t},i=JSON.stringify(r);$.ajax({type:"POST",url:n.playSoundApi,contentType:"application/json; charset=utf-8",dataType:"json",data:i,success:n.handlePlaySongResponse,error:function(){alertify.error("Impossible de lire la musique :(")}})},handlePlaySongResponse:function(e){e.id&&n.initAlertChoice(e)},getHtmlResult:function(e){n.resultsCount=0;var t="",r=$.parseHTML(e);return n.resultsCount=$(r).find(".yt-lockup").size(),$(r).find(".yt-lockup").each(function(e){var r,i,o,a;if($(this).find("button").each(function(){$(this).remove()}),r=$(this).find(".yt-lockup-thumbnail"),o=$(r).find("a").prop("href"),a=$(this).find(".yt-lockup-content").find("a").html(),e>5){var l=n.forceImageDisplay(r);l!==!1&&$(r).find("img").prop("src",l)}i=$(r).find("img").prop("src");var c='<div class="result-block col s12 m12 l4">';c+='<a href="'+o+'">',c+='<img class="result-block-img" src="'+i+'"/>',c+='</a><br/><span class="result-block-title">'+a+"</span>",c+="</div>",t+=c}),t},forceImageDisplay:function(e){var n=$(e).find("img"),t=$(n).attr("src").split("."),r=t[t.length-1];return"gif"===r?$(n).data("thumb"):!1},initAlertChoice:function(e){alertify.confirm().set({modal:!1,message:"Une musique est déjà en cours de lecture...",onok:function(){n.playSong(e,!0),$(".alertify").remove()},labels:{ok:"Forcer ma musique",cancel:"Annuler"},title:"C'est embarassant..."}).show()},addItemToServerPlaylist:function(){for(var e in n.playlist)if(e===SocketManager.musicSelected)return void alertify.warning("Cette musique est déjà dans la playlist.");SocketManager.addPlaylist()},toggleOverlay:function(e){if($("#overlay").length>0||e===!0)return void $("#overlay").remove();var n='<div id="overlay"><div class="progress"><div class="indeterminate"></div></div>';$(n).appendTo("body")},buildSearchUrl:function(){return n.searchPatternApi+n.lastSearchedPattern+"/"+n.currentPage},getPage:function(t){n.toggleOverlay(),"+"===t?n.currentPage++:n.currentPage--,window.scrollTo(0,0),$.ajax({type:"GET",url:n.buildSearchUrl(),success:e.YtSearchResponse,error:function(){alertify.error("Impossible de lancer une recherche :(")}})},setVolumeIndicator:function(e){$(".volume-indicator").each(function(){$(this).text(e)})},reSynced:function(){void 0!==typeof n.reSyncPopup&&clearTimeout(n.reSyncPopup),n.reSyncPopup=setTimeout(function(){alertify.closeAll(),alertify.dismissAll(),$("#overlay-transparent-loader").addClass("hidden"),alertify.success("Connexion rétablie !<br/>Bonne écoute sur Open-Dj"),n.toggleOverlay(!0),n.reSyncPopup=void 0},3e3)},pingTimeout:function(){void 0!==typeof n.pingTimeOutPopup&&clearTimeout(n.pingTimeOutPopup);var e="Connexion avec le serveur perdue :(<br/><br/>Le service sera indisponible tant que la liaison n'est pas réétablie",t="Reconnexion...";n.pingTimeOutPopup=setTimeout(function(){alertify.closeAll(),alertify.dismissAll(),alertify.alert("Connexion perdue",e).set("onok",function(e){$("#overlay-transparent-loader").removeClass("hidden"),alertify.error(t,0)}),n.pingTimeOutPopup=void 0},3e3)}},n=e;window.YoutubePlayer=e}(),function(){"use strict";var e={conn:!1,youtubePlayerInitialized:!1,linkServerEnabled:!1,initialize:function(){var e=$("#config").data("host"),t=$("#config").data("port");$("#config").remove();var r=t.length>0?e+":"+t:e;n.conn=io.connect(r),n.conn.on("disconnect",function(){n.linkServerEnabled=!1,YoutubePlayer.pingTimeout()}),n.conn.on("connect",function(e){n.linkServerEnabled=!0,n.youtubePlayerInitialized?n.reSyncWithServer():(n.conn.emit("new_user"),YoutubePlayer.initialize(),n.youtubePlayerInitialized=!0)}),n.conn.on("annoucement",function(e){alertify.warning(e)}),n.conn.on("volume-value",function(e){YoutubePlayer.setVolumeIndicator(e)}),n.conn.on("playlist",function(e){YoutubePlayer.refreshPlaylist(e)})},reSyncWithServer:function(){var e={searchingPattern:YoutubePlayer.lastSearchedPattern};n.conn.emit("reSyncUser",e),YoutubePlayer.reSynced()},modifyVolume:function(e){n.conn.emit("modifyVolume",e)}},n=e;$(document).ready(function(){e.initialize()}),window.SocketManager=e}();